<!-- Apex Legends Section -->
<div class="pt-8 ">
  <!-- Main Content: Apex Legends List -->
  <!-- Section Header with Tabs -->
  <div class="mb-6">
    <div class="flex flex-col border-b sm:flex-row sm:items-center sm:justify-between gap-4 mb-4">
      <h2
        class="font-[Oswald] font-normal text-sm tracking-wider uppercase bg-[#2013db] text-white px-4 py-2 inline-block">
        APEX LEGENDS
      </h2>

      <!-- Category Tabs -->
      <div class="flex flex-wrap items-center gap-2 text-sm relative">
        <!-- All Tab -->
        <button data-category="all"
          class="apex-category-tab active text-slate-700 hover:text-accent font-medium transition-colors px-2 py-1 border-b-2 border-transparent">
          All
        </button>

        <!-- Dynamic Apex Legends Categories -->
        {{ $apexCategories := slice "Apex Legends" "Battle Royale" "Esports" }}
        {{ range $apexCategories }}
        <button data-category="{{ . }}"
          class="apex-category-tab text-slate-700 hover:text-accent font-medium transition-colors px-2 py-1 border-b-2 border-transparent">
          {{ . }}
        </button>
        {{ end }}

        <!-- More Dropdown -->
        <div class="relative apex-more-dropdown">
          <button
            class="apex-more-toggle text-[#2013db] hover:bg-accent/90 hover:text-white font-medium transition-colors px-3 py-1.5 flex items-center rounded gap-1 uppercase text-xs tracking-wide">
            More
            <svg class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </button>

          <!-- Dropdown Menu -->
          <div
            class="apex-more-menu hidden absolute right-0 mt-2 w-48 bg-white border border-gray-200 rounded-lg shadow-lg z-50 max-h-64 overflow-y-auto">
            <div class="py-1">
              {{ $apexMoreCategories := slice "Guides" "Updates" "News" }}
              {{ range $apexMoreCategories }}
              <a href="#" data-category="{{ . }}"
                class="apex-category-tab-dropdown block px-4 py-2 text-sm text-slate-700 hover:bg-accent hover:text-white transition-colors">
                {{ . }}
              </a>
              {{ end }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Apex Articles Container -->
  <div id="apex-articles-container" class="space-y-4">
    <!-- Loading Skeleton -->
    <div id="apex-loading-skeleton" class="hidden">
      <!-- Apex Article Skeleton (8 items) -->
      <div class="space-y-4">
        <!-- Skeleton Card 1 -->
        <div class="apex-skeleton-card flex gap-4 bg-white border border-gray-200 rounded-lg overflow-hidden">
          <div class="apex-skeleton-image w-48 h-32 shrink-0"></div>
          <div class="flex-1 p-4">
            <div class="apex-skeleton-text h-6 w-3/4 mb-2"></div>
            <div class="apex-skeleton-text h-4 w-1/4 mb-2"></div>
            <div class="apex-skeleton-text h-4 w-full mb-1"></div>
            <div class="apex-skeleton-text h-4 w-5/6"></div>
          </div>
        </div>
        <!-- Skeleton Card 2 -->
        <div class="apex-skeleton-card flex gap-4 bg-white border border-gray-200 rounded-lg overflow-hidden">
          <div class="apex-skeleton-image w-48 h-32 shrink-0"></div>
          <div class="flex-1 p-4">
            <div class="apex-skeleton-text h-6 w-2/3 mb-2"></div>
            <div class="apex-skeleton-text h-4 w-1/5 mb-2"></div>
            <div class="apex-skeleton-text h-4 w-full mb-1"></div>
            <div class="apex-skeleton-text h-4 w-4/5"></div>
          </div>
        </div>
        <!-- Skeleton Card 3 -->
        <div class="apex-skeleton-card flex gap-4 bg-white border border-gray-200 rounded-lg overflow-hidden">
          <div class="apex-skeleton-image w-48 h-32 shrink-0"></div>
          <div class="flex-1 p-4">
            <div class="apex-skeleton-text h-6 w-4/5 mb-2"></div>
            <div class="apex-skeleton-text h-4 w-1/3 mb-2"></div>
            <div class="apex-skeleton-text h-4 w-full mb-1"></div>
            <div class="apex-skeleton-text h-4 w-3/4"></div>
          </div>
        </div>
        <!-- Skeleton Card 4 -->
        <div class="apex-skeleton-card flex gap-4 bg-white border border-gray-200 rounded-lg overflow-hidden">
          <div class="apex-skeleton-image w-48 h-32 shrink-0"></div>
          <div class="flex-1 p-4">
            <div class="apex-skeleton-text h-6 w-3/5 mb-2"></div>
            <div class="apex-skeleton-text h-4 w-1/4 mb-2"></div>
            <div class="apex-skeleton-text h-4 w-full mb-1"></div>
            <div class="apex-skeleton-text h-4 w-5/6"></div>
          </div>
        </div>
        <!-- Skeleton Card 5 -->
        <div class="apex-skeleton-card flex gap-4 bg-white border border-gray-200 rounded-lg overflow-hidden">
          <div class="apex-skeleton-image w-48 h-32 shrink-0"></div>
          <div class="flex-1 p-4">
            <div class="apex-skeleton-text h-6 w-2/3 mb-2"></div>
            <div class="apex-skeleton-text h-4 w-1/5 mb-2"></div>
            <div class="apex-skeleton-text h-4 w-full mb-1"></div>
            <div class="apex-skeleton-text h-4 w-4/5"></div>
          </div>
        </div>
        <!-- Skeleton Card 6 -->
        <div class="apex-skeleton-card flex gap-4 bg-white border border-gray-200 rounded-lg overflow-hidden">
          <div class="apex-skeleton-image w-48 h-32 shrink-0"></div>
          <div class="flex-1 p-4">
            <div class="apex-skeleton-text h-6 w-3/4 mb-2"></div>
            <div class="apex-skeleton-text h-4 w-1/3 mb-2"></div>
            <div class="apex-skeleton-text h-4 w-full mb-1"></div>
            <div class="apex-skeleton-text h-4 w-5/6"></div>
          </div>
        </div>
        <!-- Skeleton Card 7 -->
        <div class="apex-skeleton-card flex gap-4 bg-white border border-gray-200 rounded-lg overflow-hidden">
          <div class="apex-skeleton-image w-48 h-32 shrink-0"></div>
          <div class="flex-1 p-4">
            <div class="apex-skeleton-text h-6 w-4/5 mb-2"></div>
            <div class="apex-skeleton-text h-4 w-1/4 mb-2"></div>
            <div class="apex-skeleton-text h-4 w-full mb-1"></div>
            <div class="apex-skeleton-text h-4 w-3/4"></div>
          </div>
        </div>
        <!-- Skeleton Card 8 -->
        <div class="apex-skeleton-card flex gap-4 bg-white border border-gray-200 rounded-lg overflow-hidden">
          <div class="apex-skeleton-image w-48 h-32 shrink-0"></div>
          <div class="flex-1 p-4">
            <div class="apex-skeleton-text h-6 w-2/3 mb-2"></div>
            <div class="apex-skeleton-text h-4 w-1/5 mb-2"></div>
            <div class="apex-skeleton-text h-4 w-full mb-1"></div>
            <div class="apex-skeleton-text h-4 w-4/5"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- No Results Message -->
    <div id="apex-no-results" class="hidden text-center py-12">
      <p class="text-slate-500 text-lg">No articles found for this category.</p>
    </div>

    <!-- Apex Articles List -->
    <div id="apex-articles-list" class="space-y-8">
      {{ $apexArticles := where .Site.RegularPages "Type" "posts" }}
      {{ $apexArticles = where $apexArticles "Params.categories" "intersect" (slice "Apex Legends" "Battle Royale"
      "Esports" "Guides" "Updates" "News") }}
      {{ range $apexArticles }}
      <article class="apex-article-item group bg-white overflow-hidden   transition-shadow duration-300"
        data-categories='{{ delimit .Params.categories "," }}'>
        <a href="{{ .RelPermalink }}" class="flex gap-8 ">
          <!-- Image Container -->
          <div class="w-62 h-36 shrink-0 overflow-hidden ">
            <img src="https://picsum.photos/seed/{{ .Title | urlize }}/400/250" alt="{{ .Title }}"
              class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" />
          </div>

          <!-- Content Container -->
          <div class="flex-1 flex flex-col justify-between">
            <!-- Title -->
            <h3
              class="font-medium text-xl uppercase leading-tight  group-hover:text-accent transition-colors text-slate-900 line-clamp-2">
              {{ .Title }}
            </h3>

            <!-- Category and Date -->
            <div class="flex items-center gap-2 mb-3">
              <!-- Single Category Display -->
              {{ $validCategories := slice "Apex Legends" "Battle Royale" "Esports" "Guides" "Updates" "News" }}
              {{ range .Params.categories }}
              {{ if and (in $validCategories .) (not ($.Scratch.Get "categoryFound")) }}
              <span class="bg-black text-white text-xs font-normal tracking-wider uppercase px-2 py-1">
                {{ . }}
              </span>
              {{ $.Scratch.Set "categoryFound" true }}
              {{ end }}
              {{ end }}
              {{ $.Scratch.Delete "categoryFound" }}

              <!-- Date -->
              <span class="text-sm text-slate-500 font-medium">
                {{ .Date.Format "December 11, 2025" }}
              </span>
            </div>

            <!-- Paragraph -->
            <p class="text-slate-600 text-sm leading-relaxed line-clamp-3">
              {{ .Summary }}
            </p>
          </div>
        </a>
      </article>
      {{ end }}
    </div>

    <!-- Load More Button -->
    <div class="text-center mt-8">
      <button id="apex-load-more"
        class="hover:bg-accent-hover  hover:text-white border border-gray-300 text-gray-600 font-light   text-sm py-2 px-4 transition-colors duration-300 tracking-wider flex items-center gap-2 mx-auto">
        Load more
        <div class="text-gray-400  hover:text-white font-light mt-[5px] text-xs"><i class="fa-solid fa-angle-right"></i>
        </div>
      </button>
    </div>
  </div>

  <style>
    .apex-skeleton-card {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 0.5rem;
      overflow: hidden;
    }

    .apex-skeleton-image {
      background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 0.375rem;
    }

    .apex-skeleton-text {
      background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 0.25rem;
      height: 1rem;
      margin-bottom: 0.5rem;
    }

    @keyframes shimmer {
      0% {
        background-position: -200% 0;
      }

      100% {
        background-position: 200% 0;
      }
    }
  </style>

  <!-- JavaScript for Apex Category Filtering -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const apexCategoryTabs = document.querySelectorAll(".apex-category-tab");
      const apexCategoryTabsDropdown = document.querySelectorAll(
        ".apex-category-tab-dropdown"
      );
      const apexArticlesContainer = document.getElementById("apex-articles-container");
      const apexLoadingSpinner = document.getElementById("apex-loading-skeleton");
      const apexNoResults = document.getElementById("apex-no-results");
      const apexMoreToggle = document.querySelector(".apex-more-toggle");
      const apexMoreMenu = document.querySelector(".apex-more-menu");
      const apexLoadMoreBtn = document.getElementById("apex-load-more");

      // Toggle More Dropdown
      apexMoreToggle.addEventListener("click", function (e) {
        e.stopPropagation();
        apexMoreMenu.classList.toggle("hidden");
        const svg = this.querySelector("svg");
        if (apexMoreMenu.classList.contains("hidden")) {
          svg.style.transform = "rotate(0deg)";
        } else {
          svg.style.transform = "rotate(180deg)";
        }
      });

      // Close dropdown when clicking outside
      document.addEventListener("click", function (e) {
        if (!e.target.closest(".apex-more-dropdown")) {
          apexMoreMenu.classList.add("hidden");
          const svg = apexMoreToggle.querySelector("svg");
          svg.style.transform = "rotate(0deg)";
        }
      });

      // Filter function
      function filterApexArticles(category) {
        // Show loading
        apexLoadingSpinner.classList.remove("hidden");
        apexArticlesContainer.classList.add("opacity-50");

        // Simulate loading delay
        setTimeout(() => {
          const articles = document.querySelectorAll(".apex-article-item");
          let visibleCount = 0;

          console.log(`Filtering Apex articles for category: ${category}`);
          console.log(`Total Apex articles found: ${articles.length}`);

          // Define valid categories for better filtering
          const validCategories = ["Apex Legends", "Battle Royale", "Esports", "Guides", "Updates", "News"];

          articles.forEach((article) => {
            const categoriesStr = article.dataset.categories || "";
            const categories = categoriesStr ? categoriesStr.split(",") : [];
            // Filter to only include valid categories
            const validArticleCategories = categories.filter(cat =>
              validCategories.some(valid => valid.toLowerCase() === cat.trim().toLowerCase())
            );

            console.log(`Apex article categories: ${JSON.stringify(validArticleCategories)}`);

            const shouldShow = category === "all" ||
              validArticleCategories.some(
                (cat) => cat.trim().toLowerCase() === category.toLowerCase()
              );

            if (shouldShow) {
              article.classList.remove("hidden");
              article.style.display = "block";
              visibleCount++;
              console.log(`Showing Apex article: ${article.querySelector('h3').textContent}`);
            } else {
              article.classList.add("hidden");
              article.style.display = "none";
            }
          });

          console.log(`Apex visible count: ${visibleCount}`);

          // Hide loading
          apexLoadingSpinner.classList.add("hidden");
          apexArticlesContainer.classList.remove("opacity-50");

          // Show/hide no results message
          if (visibleCount === 0) {
            apexNoResults.classList.remove("hidden");
          } else {
            apexNoResults.classList.add("hidden");
          }

          // Update active tab for both regular tabs and dropdown tabs
          apexCategoryTabs.forEach((tab) => {
            if (tab.dataset.category === category) {
              tab.classList.add("active", "border-accent", "text-accent");
            } else {
              tab.classList.remove("active", "border-accent", "text-accent");
            }
          });

          apexCategoryTabsDropdown.forEach((tab) => {
            if (tab.dataset.category === category) {
              tab.classList.add("bg-accent", "text-white");
            } else {
              tab.classList.remove("bg-accent", "text-white");
            }
          });
        }, 300);
      }

      // Add click handlers to tabs
      apexCategoryTabs.forEach((tab) => {
        tab.addEventListener("click", function (e) {
          e.preventDefault();
          const category = this.dataset.category;
          filterApexArticles(category);
        });
      });

      // Add click handlers to dropdown items
      apexCategoryTabsDropdown.forEach((tab) => {
        tab.addEventListener("click", function (e) {
          e.preventDefault();
          const category = this.dataset.category;
          filterApexArticles(category);
          apexMoreMenu.classList.add("hidden");
          const svg = apexMoreToggle.querySelector("svg");
          svg.style.transform = "rotate(0deg)";
        });
      });

      // Load More functionality
      apexLoadMoreBtn.addEventListener("click", function () {
        // Show loading
        this.textContent = "Loading...";
        this.disabled = true;

        // Simulate loading more articles
        setTimeout(() => {
          // In a real implementation, this would load more articles from the server
          // For now, we'll just show a message
          this.textContent = "No More Articles";
          this.classList.add("opacity-50", "cursor-not-allowed");
        }, 1000);
      });
    });
  </script>

  <style>
    .apex-category-tab.active {
      color: var(--accent-color, #6366f1);
      border-bottom-color: var(--accent-color, #6366f1);
    }

    .apex-more-menu {
      scrollbar-width: thin;
      scrollbar-color: #cbd5e1 #f1f5f9;
    }

    .apex-more-menu::-webkit-scrollbar {
      width: 6px;
    }

    .apex-more-menu::-webkit-scrollbar-track {
      background: #f1f5f9;
    }

    .apex-more-menu::-webkit-scrollbar-thumb {
      background: #cbd5e1;
      border-radius: 3px;
    }
  </style>
</div>